---
layout: post
title:  mysql5.7编译安装
date:   2019-12-03
categories: mysql
permalink : mysql/configureInstall.html
description: mysql5.7编译安装
show : true
---

##### 下载mysql5.7

```shell
wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.22.tar.gz
tar -zxvf mysql-5.7.22.tar.gz
```

##### 下载boost

```shell
wget http://www.sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.gz
tar -zxvf boost_1_59_0.tar.gz
mv boost_1_59_0 /usr/local/boost
```

##### 安装mysql5.7

如果系统自带mariadb包，卸载

```shell
yum remove mysql
```

##### 安装依赖

```shell
yum -y install cmake gcc gcc-c++ bison ncurses ncurses-devel
```

##### 创建用户组、用户

```shell
groupadd mysql
useradd -g mysql -s /sbin/nologin -M mysql
```

##### 编译安装

```shell
cmake \
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
-DMYSQL_DATADIR=/usr/local/mysql/data \
-DWITH_BOOST=/usr/local/boost \
-DSYSCONFDIR=/etc \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DWITH_FEDERATED_STORAGE_ENGINE=1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DENABLED_LOCAL_INFILE=1 \
-DENABLE_DTRACE=0 \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci \
-DWITH_EMBEDDED_SERVER=1

make && make install
```

##### 配置

设置权限

```shell
chown -R mysql:mysql /usr/local/mysql
```

修改配置文件

```shell
vim /etc/my.cnf
#写入
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html
# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
# *** default location during install, and will be replaced if you
# *** upgrade to a newer version of MySQL.
[client]
port=3306
[mysql]
default-character-set=utf8

[mysqld]
port=3306
basedir=/usr/local/mysql
datadir=/usr/local/mysql/data
character-set-server=utf8
default-storage-engine=InnoDB
max_connections=512

query_cache_size=0
tmp_table_size=18M

thread_cache_size=8
myisam_max_sort_file_size=64G
myisam_sort_buffer_size=35M
key_buffer_size=25M
read_buffer_size=64K
read_rnd_buffer_size=256K
sort_buffer_size=256K

innodb_flush_log_at_trx_commit=1
innodb_log_buffer_size=1M
innodb_buffer_pool_size=47M
innodb_log_file_size=24M
innodb_thread_concurrency=8
```

初始化mysql

```shell
/usr/local/mysql/bin/mysqld \
--initialize-insecure \
--user=mysql \
--basedir=/usr/local/mysql \
--datadir=/usr/local/mysql/data
```

添加MySQL环境变量

```shell
vim /etc/profile
#增加

PATH=$PATH:/usr/local/mysql/bin:
export PATH
```

刷新环境变量

```shell
source /etc/profile
```

设置开机自启动

```shell
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld
chmod +x /etc/init.d/mysqld
chkconfig --add mysqld
```

启动mysql

```shell
mysqld_safe --defaults-file=/etc/my.cnf &
```

重启mysql

```shell
/etc/init.d/mysqld restart
```

